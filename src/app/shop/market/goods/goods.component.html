<div class="goods-page" *ngIf="data">
  <div class="container">
      <nav class="breadcrumb">
          <a class="breadcrumb-item" routerLink="../../">Home</a>
          <a class="breadcrumb-item" *ngIf="data.category" [routerLink]="'../../category/' + data.cat_id">{{ data.category.name }}</a>
          <span class="breadcrumb-item active">{{ data.name }}</span>
      </nav>

      <div class="row info-box">
          <div class="col-md-6">
            <app-gallery-slider [items]="galleryItems"></app-gallery-slider>
          </div>
          <div class="col-md-6">
            <div class="bg-white">
                <div class="intro">
                    <div class="name">
                        {{ data.name }}
                        <a class="comment">
                            <span>98%</span>
                            <span>好评率</span>
                        </a>
                    </div>
                    <div class="desc">
                        {{ data.brief }}
                    </div>
                </div>
                <div class="price-box">
                    <div class="flex-line">
                        <div>活动价</div>
                        <div class="price">￥{{ data.price }}</div>
                    </div>
                    <div class="flex-line" *ngIf="couponItems.length > 0">
                        <div>领券</div>
                        <div>
                            <ng-container *ngFor="let item of couponItems">
                              <div class="coupon-item">
                                  <div class="item-body">
                                    {{ item.name }}
                                  </div>
                                  <div class="item-action">
                                      {{ item.can_receive ? '领券' : '已领' }}
                                  </div>
                              </div>
                            </ng-container>
                        </div>
                    </div>
                    <div class="flex-line" *ngIf="promoteItems.length > 0">
                        <div>促销</div>
                        <div>
                            <ng-container *ngFor="let item of promoteItems">
                                <a class="promote-item">
                                    <div class="item-name">{{ formatPromote(item.type) }}</div>
                                    <div class="item-body">
                                        {{ item.name }}
                                    </div>
                                </a>
                              </ng-container>
                        </div>
                    </div>
                    <div class="flex-line">
                        <div>积分</div>
                        <div>购买最高得42积分</div>
                    </div>
                    <div class="flex-line">
                        <div>配送
                        </div>
                        <div>至<app-region url="shop/region/tree"></app-region></div>
                    </div>
                   
                    <hr>
                    <div class="flex-line">
                        <div>服务</div>
                        <div>
                            ･ 支持30天无忧退换货    
                            ･ 48小时快速退款    
                            ･ 满88元免邮费    
                            ･ 自营品牌    
                            ･ 国内部分地区无法配送 
                        </div>
                    </div>
                    
                </div>
                <div class="property-box">
                    <ng-container *ngFor="let item of data.properties;let i = index">
                      <div class="group" [ngClass]="{'multi-group': item.type == 2}">
                          <div class="group-header">{{ item.name }}</div>
                          <div class="group-body">
                              <ng-container *ngFor="let attr of item.attr_items">
                                  <span>{{ attr.value }}</span>
                              </ng-container>
                          </div>
                      </div>
                    </ng-container>
                    <div class="group">
                        <div class="group-header">
                          Amount
                        </div>
                        <div class="group-body">
                          <div class="number-box">
                              <i class="iconfont icon-minus" (click)="tapAmountMinus()"></i>
                              <input type="text" class="number-input" [(ngModel)]="amount" (change)="onAmountChange()">
                              <i class="iconfont icon-plus" (click)="tapAmountPlus()"></i>
                          </div>
                        </div>
                    </div>
                </div>
                <div class="actions">
                      <ng-container *ngIf="stock > 0; else elseTemplate">
                          <a (click)="tapBuy()" class="btn btn-danger">
                              BUY NOW
                          </a>
                          <a (click)="tapAddToCart()" class="btn btn-primary">
                              <i class="iconfont icon-shopping-cart"></i>
                              ADD TO CART
                          </a>
                      </ng-container>
                      <ng-template #elseTemplate>
                          <a href="javascript:;" class="btn btn-secondary">
                              Insufficient inventory cannot be purchased 
                          </a>
                      </ng-template>
                      <a class="btn btn-collect" [ngClass]="{active: data.is_collect}" (click)="tapCollect()">
                          <i class="iconfont" [ngClass]="{'icon-heart-o': !data.is_collect, 'icon-heart': data.is_collect}"></i>
                          LIKE
                      </a>
                </div>
            </div>
          </div>
      </div>

      <div class="template-lazy" appLazyLoad (lazyLoading)="loadRecommend()">
        <div class="panel" *ngIf="recommendItems.length > 0">
            <div class="panel-header">
                People who viewed this also viewed
            </div>
            <div class="panel-body">
                <app-goods-slider [items]="recommendItems"></app-goods-slider>
            </div>
        </div>
      </div>

      <div class="row detail-box">
          <div class="col-md-8">
            <div class="tab-box">
                <div class="tab-header">
                    <div class="tab-item" [ngClass]="{active: tabIndex < 1}" (click)="tabIndex = 0">
                    Product details
                    </div>
                    <div class="tab-item" [ngClass]="{active: tabIndex == 1}" (click)="tabIndex = 1">
                    Comments
                    </div>
                    <div class="tab-item" [ngClass]="{active: tabIndex == 2}" (click)="tabIndex = 2">
                    Issues
                    </div>
                    <div class="tab-item" *ngIf="activity && activity.type == 1" [ngClass]="{active: tabIndex == 3}" (click)="tabIndex = 3">
                      出价记录
                  </div>
                </div>
                <div class="tab-body bg-white">
                      <div class="tab-item" [ngClass]="{active: tabIndex < 1}">
                          <div class="content-box" [innerHTML]="content">
                          </div>
                      </div>
                      <div id="comment-tab" class="tab-item" [ngClass]="{active: tabIndex == 1}">
                          <div class="comment-box" *ngIf="commentSubtotal">
                              <div class="comment-header">
                                  <div class="text-center">
                                  好评率
                                  </div>
                                  <div>
                                  Customer reviews：
                                  </div>
                                  <div class="text-center">
                                      <div class="rate">{{ commentSubtotal.favorable_rate }}%</div>
                                      <div class="score">
                                          <app-star [ngModel]="commentSubtotal.avg"></app-star>
                                      </div>
                                  </div>
                                  <div class="tag-box">
                                      <span class="active">All({{ commentSubtotal.total }})</span>
                                      <ng-container *ngFor="let item of commentSubtotal.tags">
                                          <span>{{ item.label }}({{ item.count }})</span>
                                      </ng-container>
                                  </div>
                              </div>
                              <div class="comment-filter">
                                  <span>SORT</span>
                                  <a href="" class="active">默认</a>
                                  <a href="">评价时间</a>
                              </div>
                              <div class="comment-page-box">
                                  <ng-container *ngFor="let item of commentItems">
                                      <div class="comment-item">
                                          <div class="user-box">
                                              <div class="avatar">
                                                  <img [src]="item.user.avatar" alt="">
                                              </div>
                                              <div class="name">{{ item.user.name }}</div>
                                          </div>
                                          <div>
                                              <div class="score">
                                                  <app-star [ngModel]="item.rank"></app-star>
                                              </div>
                                              <div class="attr">
                                              规格:雾白
                                              </div>
                                              <div class="content">{{ item.content }}</div>
                                              <ul class="image-box" *ngIf="item.images">
                                                  <li *ngFor="let it of item.images">
                                                      <img [src]="it.image" alt="">
                                                  </li>
                                              </ul>
                                              <div class="time">{{ item.created_at }}</div>
                                          </div>
                                      </div>
                                  </ng-container>
                                  
                              </div>
                          </div>
                      </div>
                      <div class="tab-item issue-box" [ngClass]="{active: tabIndex == 2}">
                          
                      </div>
                      <div class="tab-item log-box" *ngIf="activity && activity.type == 1" [ngClass]="{active: tabIndex == 3}">
                          <table class="table">
                              <thead>
                                  <tr>
                                      <th>用户名</th>
                                      <th>出价金额</th>
                                      <th>出价时间</th>
                                      <th>状态</th>
                                  </tr>
                              </thead>
                              <tbody>
                                  <tr *ngFor="let item of logItems">
                                      <td>{{ item.user?.name }}</td>
                                      <td>{{ item.bid }}</td>
                                      <td>{{ item.created_at }}</td>
                                      <td>{{ item.status > 0 ? '淘汰' : '领先' }}</td>
                                  </tr>
                              </tbody>
                          </table>
                      </div>
                </div>
            </div>
          </div>

          <div class="col-md-4">
            <div class="template-lazy" appLazyLoad (lazyLoading)="loadHot()">
                <div class="panel" *ngIf="hotItems.length > 0">
                    <div class="panel-header">
                        TOP/24
                    </div>
                    <div class="panel-body">
                        <div  class="goods-item" *ngFor="let item of hotItems">
                            <div class="thumb">
                                <a [routerLink]="'../' + item.id">
                                    <img [src]="item.thumb" alt="">
                                </a>
                            </div>
                            <div class="name">{{ item.name }}</div>
                            <div class="price">{{ item.price }}</div>
                        </div>
                    </div>
                </div>
              </div>
          </div>
          
      </div>
  </div>
</div>