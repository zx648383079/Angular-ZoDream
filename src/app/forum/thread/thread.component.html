<div class="container" *ngIf="thread">
  <ul  class="breadcrumb">
      <li class="breadcrumb-item">
          <a routerLink="/" class="iconfont icon-home"></a>
      </li><li class="breadcrumb-item">
          <a routerLink="../../">圈子首页</a>
      </li>
      <li class="breadcrumb-item" *ngFor="let item of thread.path">
        <a [routerLink]="'../../' + item.id">{{ item.name }}</a>
        </li>
      <li class="breadcrumb-item active">{{ thread.title }}
      </li>
  </ul>
</div>

<div class="container">
    <div class="thread-box">
        <div class="thread-title" *ngIf="thread"  [ngClass]="{'thread-highlight': thread.is_highlight}">
            <div class="count">
                <span>查看：{{ thread.view_count | numberFormat }}</span>
                <span>回复：{{ thread.post_count | numberFormat }}</span>
            </div>
            <div class="title">
                <ng-container *ngIf="thread.is_closed">
                    <i class="iconfont icon-lock" title="主题已关闭"></i>
                </ng-container>
                <ng-container *ngIf="!thread.is_closed">
                    <i class="iconfont icon-file"></i>
                </ng-container>
                <em class="tag-item" *ngIf="thread.classify">
                    [<a>{{ thread.classify.name }}</a>]
                </em>
                {{ thread.title }} 
                <i class="iconfont icon-fire" *ngIf="thread.is_digest"></i>
                <a class="new-tag" *ngIf="thread.is_new">New</a>
            </div>
        </div>
        <div class="post-list">
            <ng-container *ngFor="let item of items">
              <ng-container *ngIf="item.grade < 1; else elseTemplate">
                <div class="post-item">
                    <div class="post-user">
                        <div class="name">{{ item.user.name }}</div>
                        <div class="avatar">
                            <img [src]="item.user.avatar" alt="">
                        </div>
                    </div>
                    <div class="post-content">
                        <div class="header">
                            <i class="iconfont icon-user"></i>
                                发表于 {{ item.created_at | ago }} 
                            <i class="split">|</i>
                            <a *ngIf="queries.user < 1" (click)="tapSeeUser(item.user_id)">只看该作者</a>
                            <a *ngIf="queries.user > 0" (click)="tapSeeUser(0)">查看全部楼层</a>
                            <div class="action">
    
                            </div>
                        </div>
                        <div class="last-time">最后编辑于 {{ item.updated_at | ago }}</div>
                        <div class="content">
                            <app-post-block [value]="item.content" (tapped)="tapBlock($event, item)"></app-post-block>
                        </div>
                        <div class="action">
    
                        </div>
                        <div class="footer">
                            <a *ngIf="user" (click)="tapReply(item)">回复</a>
                            <a *ngIf="thread.digestable"  (click)="toggeDigest()">设为精华</a>
                            <a *ngIf="thread.highlightable" (click)="toggeHighlight()">设为高亮</a>
                            <a *ngIf="thread.closeable" (click)="toggeClose()">设为关闭</a>
                        </div>
                    </div>
                </div>
              </ng-container>
              <ng-template #elseTemplate>
                <div class="post-item">
                    <div class="post-user">
                        <div class="name">{{ item.user.name }}</div>
                        <div class="avatar">
                            <img [src]="item.user.avatar" alt="">
                        </div>
                    </div>
                    <div class="post-content">
                        <div class="header">
                            <i class="iconfont icon-user"></i>
                                发表于 {{ item.created_at | ago }} 
                            <i class="split">|</i>
                            <a *ngIf="queries.user < 1" (click)="tapSeeUser(item.user_id)">只看该作者</a>
                            <a *ngIf="queries.user > 0" (click)="tapSeeUser(0)">查看全部楼层</a>
                            <div class="action">
                                {{ item.grade }}楼
                            </div>
                        </div>
                        <div class="content">
                            <app-post-block [value]="item.content" [readable]="item.is_public_post" (tapped)="tapBlock($event, item)"></app-post-block>
                          </div>
                        <div class="footer">
                            <a *ngIf="user && item.is_public_post" (click)="tapReply(item)">回复</a>
                            <a *ngIf="item.deleteable" (click)="tapRemove(item)">删除</a>
                        </div>
                    </div>
                </div>
              </ng-template>
              
            </ng-container>
            
        </div>
        <div class="paging-box">
            <app-pagination [total]="total" [(page)]="queries.page" [perPage]="queries.per_page" (pageChange)="tapPage()"></app-pagination>
        </div>
        <div class="post-item post-new" *ngIf="user && thread && !thread.is_closed">
            <div class="post-user">
                <div class="name">{{ user.name }}</div>
                <div class="avatar">
                    <img [src]="user.avatar" alt="">
                </div>
            </div>
            <div id="post-editor" class="post-content">
                <form [formGroup]="form" (ngSubmit)="tapSubmit()">
                    <app-forum-editor formControlName="content" placeholder="请输入帖子内容"></app-forum-editor>
                    <div class="footer">
                        <button class="btn btn-primary" [disabled]="form.invalid">发表回复</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>