<div class="container" *ngIf="thread">
  <ul  class="breadcrumb">
      <li class="breadcrumb-item">
          <a routerLink="/" class="iconfont icon-home"></a>
      </li><li class="breadcrumb-item">
          <a routerLink="../../" i18n>Home</a>
      </li>
      <li class="breadcrumb-item" *ngFor="let item of thread.path">
        <a [routerLink]="'../../' + item.id">{{ item.name }}</a>
        </li>
      <li class="breadcrumb-item active">{{ thread.title }}
      </li>
  </ul>
</div>

<div class="container">
    <div class="thread-box">
        <div class="thread-title" *ngIf="thread"  [ngClass]="{'thread-highlight': thread.is_highlight}">
            <div class="count">
                <span i18n>View: {{ thread.view_count | numberFormat }}</span>
                <span i18n>Reply: {{ thread.post_count | numberFormat }}</span>
            </div>
            <div class="title">
                <ng-container *ngIf="thread.is_closed">
                    <i class="iconfont icon-lock" i18n-title title="Thread is closed "></i>
                </ng-container>
                <ng-container *ngIf="!thread.is_closed">
                    <i class="iconfont icon-file-o"></i>
                </ng-container>
                <em class="tag-item" *ngIf="thread.classify">
                    [<a>{{ thread.classify.name }}</a>]
                </em>
                <span class="title-text">{{ thread.title }} </span>
                <i class="iconfont icon-fire" *ngIf="thread.is_digest"></i>
                <a class="new-tag" *ngIf="thread.is_new">New</a>
                <div class="pull-right">
                    <i class="iconfont" [ngClass]="{'icon-sort-alpha-asc': queries.order == 'desc', 'icon-sort-alpha-desc': queries.order != 'desc'}" [title]="queries.order != 'desc' ? '倒叙浏览' : '正序浏览'" (click)="tapSortOrder()"></i>
                    <select [(ngModel)]="queries.status" class="form-control" (ngModelChange)="onStatusChange()">
                        <option *ngFor="let item of statusData.items; let i = index" [value]="i">{{ item }}</option>
                    </select>
                </div>
            </div>
        </div>
        <div class="post-list">
            <ng-container *ngFor="let item of items">
              <ng-container *ngIf="item.grade < 1; else elseTemplate">
                <div class="post-item">
                    <div class="post-user">
                        <div class="name">{{ item.user.name }}</div>
                        <div class="avatar">
                            <img [src]="item.user.avatar" alt="">
                        </div>
                    </div>
                    <div class="post-content">
                        <div class="header">
                            <i class="iconfont icon-user"></i>
                            <ng-container i18n>Published {{ item.created_at | ago }} </ng-container>
                            <i class="split">|</i>
                            <a *ngIf="queries.user < 1" (click)="tapSeeUser(item.user_id)" i18n>Only author</a>
                            <a *ngIf="queries.user > 0" (click)="tapSeeUser(0)" i18n>Back to all</a>
                            <div class="action">
    
                            </div>
                        </div>
                        <div class="last-time" i18n>Last edit {{ item.updated_at | ago }}</div>
                        <div class="content">
                            <app-post-block [value]="item.content" (tapped)="tapBlock($event, item)"></app-post-block>
                        </div>
                        <div class="post-action">
                            <div class="action-btn" [ngClass]="{active: thread.like_type == 1}" [title]="thread.like_type == 1 ? '取消点赞' : '点赞'" (click)="toggleLike()">
                                <i class="iconfont icon-thumbs-o-up"></i>
                            </div>
                            <div class="action-btn"  [ngClass]="{active: thread.is_reward}" title="打赏" (click)="tapReward(rewardModal)">
                                {{ thread.is_reward ? '已' : '' }}赏
                            </div>
                            <div class="action-btn"  [ngClass]="{active: thread.is_collected}" [title]="thread.is_collected ? '取消收藏' : '收藏'"  (click)="toggleCollect()">
                                <i class="iconfont" [ngClass]="{'icon-heart-o': !thread.is_collected, 'icon-heart': thread.is_collected}"></i>
                            </div>
                        </div>
                        <div class="footer">
                            <a *ngIf="user" (click)="tapReply(item)" i18n>Reply</a>
                            <a *ngIf="thread.digestable || thread.highlightable || thread.closeable || thread.topable"  (click)="open(modal)" i18n>Edit</a>
                        </div>
                    </div>
                </div>
              </ng-container>
              <ng-template #elseTemplate>
                <div class="post-item">
                    <div class="post-user">
                        <div class="name">{{ item.user.name }}</div>
                        <div class="avatar">
                            <img [src]="item.user.avatar" alt="">
                        </div>
                    </div>
                    <div class="post-content">
                        <div class="header">
                            <i class="iconfont icon-user"></i>
                                <ng-container>Published {{ item.created_at | ago }} </ng-container>
                                
                            <i class="split">|</i>
                            <a *ngIf="queries.user < 1" (click)="tapSeeUser(item.user_id)" i18n>Only author</a>
                            <a *ngIf="queries.user > 0" (click)="tapSeeUser(0)" i18n>Back to all</a>
                            <div class="action" i18n>
                                {{ item.grade }} floor
                            </div>
                        </div>
                        <div class="content">
                            <div class="stamp" *ngIf="item.status > 0">{{ formatStatus(item) }}</div>
                            <app-post-block [value]="item.content" [readable]="item.is_public_post" (tapped)="tapBlock($event, item)"></app-post-block>
                          </div>
                        <div class="footer">
                            <a *ngIf="user && item.is_public_post" (click)="tapReply(item)" i18n>Reply</a>
                            <a *ngIf="thread.editable" (click)="tapChange(statusModal, item)" i18n>Edit</a>
                            <a *ngIf="item.deleteable" (click)="tapRemove(item)" i18n>Delete</a>
                        </div>
                    </div>
                </div>
              </ng-template>
              
            </ng-container>
            
        </div>
        <div class="paging-box">
            <app-pagination [total]="total" [(page)]="queries.page" [perPage]="queries.per_page" (pageChange)="tapPage()"></app-pagination>
        </div>
        <div class="post-item post-new" *ngIf="user && thread && !thread.is_closed">
            <div class="post-user">
                <div class="name">{{ user.name }}</div>
                <div class="avatar">
                    <img [src]="user.avatar" alt="">
                </div>
            </div>
            <div id="post-editor" class="post-content">
                <form [formGroup]="form" (ngSubmit)="tapSubmit()">
                    <app-forum-editor formControlName="content" i18n-placeholder placeholder="Please input content"></app-forum-editor>
                    <div class="footer">
                        <app-action-button class="btn btn-primary" [disabled]="form.invalid" (tapped)="tapSubmit($event)" i18n>Post Reply</app-action-button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
<app-dialog-box #modal title="编辑">
    <ng-container *ngIf="thread">
        <div class="link-item" *ngIf="thread.topable">
            <div class="label">置顶</div>
            <div class="value">
                <app-switch [(ngModel)]="editData.top_type"></app-switch>
            </div>
        </div>
        <div class="link-item" *ngIf="thread.digestable">
            <div class="label">精华</div>
            <div class="value">
                <app-switch [(ngModel)]="editData.is_digest"></app-switch>
            </div>
        </div>
        <div class="link-item" *ngIf="thread.highlightable">
            <div class="label">高亮</div>
            <div class="value">
                <app-switch [(ngModel)]="editData.is_highlight"></app-switch>
            </div>
        </div>
        <div class="link-item" *ngIf="thread.closeable">
            <div class="label">关闭</div>
            <div class="value">
                <app-switch [(ngModel)]="editData.is_closed"></app-switch>
            </div>
        </div>
        <div class="form-group">
          <label for="remark">操作说明*</label>
          <textarea class="form-control" id="remark" [(ngModel)]="editData.remark"></textarea>
        </div>
    </ng-container>
</app-dialog-box>

<app-dialog-box #rewardModal [scrollable]="false" title="打赏">
    <div class="link-item">
        <div class="label">金额</div>
        <div class="value">
            <input type="number" class="form-control" [(ngModel)]="rewardData.amount">
        </div>
    </div>
</app-dialog-box>

<app-dialog-box #statusModal [scrollable]="false" title="修改状态">
    <app-check-input [items]="statusData.items" [rangeKey]="1"[(ngModel)]="statusData.selected"></app-check-input>
</app-dialog-box>