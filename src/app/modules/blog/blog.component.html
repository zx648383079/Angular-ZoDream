<div class="page-box" [class]="{'--with-flip': detailMode}">
    <div class="master-box">
        <div class="search-box">
            <div class="search-input">
                <i class="iconfont icon-search"></i>
                <input type="text" [field]="keywords" i18n-placeholder placeholder="Search related articles" (ngModelChange)="tapRefresh()">
            </div>
        </div>
        <div class="filter-box">
            <div class="filter-item">
                <ul>
                    @for (item of categories; track $index) {
                        <li [class]="{active: item.id == category}" (click)="tapCategory(item)">
                            {{ item.name }}
                        </li>
                    }
                </ul>
            </div>
            <div class="filter-item">
                <ul>
                    @for (item of sortItems; track $index) {
                        <li [class]="{active: item.value == sort}" (click)="tapSort(item)">
                            {{ item.name }}
                        </li>
                    }
                </ul>
            </div>
        </div>
        <app-pull-to-refresh class="items-box" (refreshChange)="tapRefresh()" (moreChange)="tapMore()" [more]="hasMore" [loading]="isLoading">
            @for (item of items; track $index) {
                <dl class="book-item" (click)="tapItem(item)">
                    <dt>
                        <a >{{ item.title }}</a>
                        <span class="book-time">{{ item.created_at | ago }}</span></dt>
                        <dd>
                            <p>{{ item.description }}</p>
                            @if (item.user) {
                                <a class="author"><i class="iconfont icon-edit"></i><b>{{ item.user.name }}</b></a>
                            }
                            @if (item.term) {
                                <a class="category"><i
                                    class="iconfont icon-bookmark"></i><b>{{ item.term.name }}</b></a>
                            }
                            @if (item.programming_language) {
                                <a class="language"><i
                                    class="iconfont icon-code"></i><b>{{ item.programming_language }}</b></a>
                            }
                            
                            <span class="comment"><i class="iconfont icon-comments"></i><b>{{ item.comment_count }}</b></span>
                            <span class="agree"><i class="iconfont icon-thumbs-up"></i><b>{{ item.recommend_count }}</b></span>
                            <span class="click"><i class="iconfont icon-eye"></i><b>{{ item.click_count }}</b></span>
                    </dd>
                </dl>
            }
        </app-pull-to-refresh>
    </div>
    <div class="detail-box">
        @if (!blog) {
            <div class="detail-loading">

            </div>
        } @else {
            <div class="title">
                <i class="iconfont icon-arrow-left" (click)="detailMode = false"></i>
                <span>{{ blog.title }}</span>
            </div>
            <div class="detail-body">
                <div class="info">
                    @if (blog.user) {
                        <a class="author" (click)="tapUser(blog.user)"><i class="iconfont icon-edit"></i><b>{{ blog.user.name }}</b></a>
                    }
                    @if (blog.term) {
                        <a class="category" (click)="tapCategory(blog.term)"><i class="iconfont icon-bookmark"></i><b>{{ blog.term.name }}</b></a>
                    }
                    @if (blog.programming_language) {
                        <a class="language" (click)="tapLanguage(blog.programming_language)"><i
                            class="iconfont icon-code"></i><b>{{ blog.programming_language }}</b></a>
                    }
                    
                    <span class="time"><i class="iconfont icon-calendar-check"></i><b>{{ blog.created_at | ago }}</b></span>
                </div>
                <article id="content" class="content">
                    @if (blog.audio_url) {
                        <app-audio-player [src]="blog.audio_url" />
                    } @else if (blog.video_url) {
                        <app-video-player [src]="blog.video_url" />
                    }
                    <app-markdown-block [value]="content" />
                    @if (blog.url) {
                        <p class="book-copyright">
                            <ng-container i18n>Please keep the original link for reprinting:</ng-container>
                            <a [href]="blog.url" [title]="blog.title">{{ blog.url }}</a>
                        </p>
                    }
                    
                  </article>
                  <div class="book-bottom">
                        @if (blog.type == 1) {
                        <div class="book-source">
                            <span i18n>Reprinted in:</span>
                            <a [href]="blog.source_url"
                                target="_blank" i18n-title title="This article is reprinted, click to view the original page">
                                {{blog.source_url}} </a>
                        </div>
                        }
                        @if (blog.tags) {
                        <div class="book-tags">
                            <span i18n>Tags:</span>
                            @for (tag of blog.tags; track $index) {
                                <a (click)="tapTag(tag.name)">{{ tag.name }}</a>ï¼Œ
                            }
                       </div>
                        }
                        
                  </div>
                  <div class="tools">
                      <span class="comment"><i class="iconfont icon-comments"></i><b>{{ blog.comment_count }}</b></span>
                      <span class="click"><i class="iconfont icon-eye"></i><b>{{ blog.click_count }}</b></span>
                      <span class="agree recommend-blog" (click)="tapRecommend()"><i class="iconfont icon-thumbs-up"></i><b>{{ blog.recommend_count }}</b></span>
                  </div>
              </div>
        }
        
        
    </div>
</div>