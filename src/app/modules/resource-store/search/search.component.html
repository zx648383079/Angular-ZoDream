<div class="container-fluid">
    <div class="row">
        <div class="col-md-12">
            <form class="search-input" (ngSubmit)="tapSearch(searchForm.value)" #searchForm="ngForm">
                <input type="text" class="form-control" name="keywords" [(ngModel)]="keywords">
                @if (keywords) {
                    <i class="iconfont icon-close" (click)="tapClearQuery()"></i>
                }
                
                <button class="btn btn-primary" i18n>Search</button>
            </form>
            <div class="search-tip-bar" i18n>
                You found {{ total | numberFormat }} resources.
            </div>
            <div class="sort-bar">
                @if (filterOpen) {
                <a class="sort-clear" (click)="filterOpen = false">
                    <i class="iconfont icon-close"></i>
                    <ng-container i18n>Filter & Refine</ng-container>
                </a>
                }
                
                <div class="sort-view-bar">
                    <div class="sort-tip" i18n>
                        Price is in CN yuan and excludes tax
                    </div>
                    <div class="view-bar">
                        <i class="iconfont icon-th-large" [ngClass]="{active: viewTable}" (click)="viewTable = true"></i>
                        <i class="iconfont icon-th-list" [ngClass]="{active: !viewTable}" (click)="viewTable = false"></i>
                    </div>
                </div>
                <div class="tab-bar">
                    <div class="item" [ngClass]="{active: queries.sort == ''}" (click)="tapSort('')" i18n>
                        Best match
                    </div>
                    <div class="item" [ngClass]="{active: queries.sort == 'hot'}" (click)="tapSort('hot')" i18n>
                        Best sellers
                    </div>
                    <div class="item" [ngClass]="{active: queries.sort == 'new'}" (click)="tapSort('new')" i18n>
                        Newest
                    </div>
                    <div class="item" [ngClass]="{active: queries.sort == 'score'}" (click)="tapSort('score')" i18n>
                        Best rated
                    </div>
                    <div class="item" [ngClass]="{active: queries.sort == 'trending'}" (click)="tapSort('trending')" i18n>
                        Trending
                    </div>
                    <div class="item" [ngClass]="{active: queries.sort == 'price'}" (click)="tapSort('price')">
                        <ng-container i18n>Price</ng-container>
                        <i class="iconfont" [ngClass]="{'icon-sort-desc': queries.sort == 'price' && queries.order != 'asc', 'icon-sort-asc': queries.sort == 'price' && queries.order == 'asc'}"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="container-fluid">
    <div class="row">
        <div class="col-md-3" [hidden]="!filterOpen">
            @for (item of filterItems; track $index) {
            <div class="panel">
                <div class="panel-header">
                    {{ item.label }}
                    <div class="panel-icon">
                        <i class="iconfont icon-angle-down"></i>
                    </div>
                </div>
                <div class="panel-body">
                    @if (item.items && item.items.length > 0) {
                    <ul>
                        @for (it of item.items; track $index) {
                            <li [ngClass]="{active: it.selected}" (click)="tapFilterItem(item, it)">
                                @if (item.multiple) {
                                <div class="check-input">
                                    <i class="iconfont icon-check-square-o"></i>
                                </div>
                                }
                                @if (!item.multiple && item.name != 'category') {
                                <div class="radio-input">
                                    <i class="iconfont icon-circle"></i>
                                </div>
                                }
                                
                                <a >{{ it.label }}</a>
                                <span class="count">{{ it.count | numberFormat }}</span>
                            </li>
                        }
                    </ul>
                    }
                    
                    @if (item.name == 'price') {
                    <div class="price-input">
                        <input type="text" class="form-control" [(ngModel)]="item.min">-
                        <input type="text" class="form-control" [(ngModel)]="item.max">
                        <div class="btn btn-primary" (click)="tapPrice(item)">
                            <i class="iconfont icon-chevron-right"></i>
                        </div>
                    </div>
                    }
                    
                </div>
            </div>
            }
            
        </div>
        <div [ngClass]="{'col-md-9': filterOpen, 'col-md-12': !filterOpen}">
            <div class="filter-wall">
                <ng-container i18n>{{ total | numberFormat }} items</ng-container>
                @for (item of selectedFilters; track $index) {
                    <div class="filter-item">
                        <span>{{ item.label }}</span>
                        <i class="iconfont icon-close" (click)="tapRemoveFilter(item.name)"></i>
                    </div>
                }
                

                <a class="filter-clear" (click)="tapClearFilter()" i18n>
                    Clear all
                </a>
            </div>

            <div class="search-body">
                @if (viewTable) {
                    <div class="row">
                        @for (item of items; track $index) {
                            <div class="col-md-3">
                            <div class="res-item">
                                <div class="item-thumb">
                                    <a [routerLink]="['../category', item.cat_id, item.id]"><img [src]="item.thumb|asset" alt=""></a>
                                    <div class="item-hat"></div>
                                </div>
                                <div class="item-body">
                                    <a class="item-name" [routerLink]="['../category', item.cat_id, item.id]">
                                        {{ item.title }}
                                    </a>
                                    <div class="item-meta">
                                        by <a (click)="tapUser(item.user_id)">{{ item.user.name }}</a> in <a (click)="tapCategory(item.cat_id)">{{ item.category.name }}</a>
                                    </div>
                                    <div class="item-action">
                                        <div class="item-price">
                                            <p>
                                                @if (item.price > 0) {
                                                    {{ item.price | currency }}
                                                } @else {
                                                    <ng-container i18n>Free</ng-container>
                                                }
                                            </p>
                                            <p class="sale" i18n>{{ item.download_count | numberFormat }} Sales</p>
                                        </div>
                                        <div class="btn-group">
                                            <a class="btn btn-outline-primary">
                                                <i class="iconfont icon-shopping-cart"></i>
                                            </a>
                                            <a [routerLink]="['../category', item.cat_id, item.id, 'preview']" class="btn btn-primary" i18n>
                                                Live Preview
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        }
                    </div>
                } @else {
                    @for (item of items; track $index) {
                    <div class="res-large-item">
                        <div class="item-thumb">
                            <a [routerLink]="['../category', item.cat_id, item.id]"><img [src]="item.thumb|asset" alt=""></a>
                            <div class="item-hat"></div>
                        </div>
                        <div class="item-body">
                            <a class="item-name" [routerLink]="['../category', item.cat_id, item.id]">
                                {{ item.title }}
                            </a>
                            <div class="item-meta">
                                by <a (click)="tapUser(item.user_id)">{{ item.user.name }}</a> in <a (click)="tapCategory(item.cat_id)">{{ item.category.name }}</a>
                            </div>
                            <div class="item-desc">
                                {{ item.description }}
                            </div>
                        </div>
                        <div class="item-action">
                            <div class="item-price">
                                @if (item.price > 0) {
                                    {{ item.price | currency }}
                                } @else {
                                    <ng-container i18n>Free</ng-container>
                                }
                            </div>
                            <app-star></app-star>
                            <p>{{ item.download_count | numberFormat }} Sales</p>
                            <p>{{ item.updated_at | ago }}</p>
                            <div class="btn-group">
                                <a class="btn btn-outline-primary">
                                    <i class="iconfont icon-shopping-cart"></i>
                                </a>
                                <a [routerLink]="['../category', item.cat_id, item.id, 'preview']" class="btn btn-primary">
                                    Live Preview
                                </a>
                            </div>
                        </div>
                    </div>
                    }
                }
            </div>


            <app-loading-tip [loading]="isLoading" [visible]="isLoading || items.length == 0"></app-loading-tip>
            <app-pagination [total]="total" [(page)]="queries.page" [perPage]="queries.per_page" (pageChange)="tapPage()"></app-pagination>
        </div>
    </div>
</div>
