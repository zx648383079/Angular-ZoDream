<div class="login-panel">
    <div class="tab-bar" [hidden]="tabIndex >= 8">
        <a [ngClass]="{active: tabIndex < 2}" (click)="tapTab(0)" i18n>Quick login</a>
        <a [ngClass]="{active: tabIndex == 2}" (click)="tapTab(2)" i18n>Account login</a>
    </div>
    <div class="mobile-body" [hidden]="tabIndex > 0">
        <a class="mobile-toggle" (click)="tapTab(1)" i18n>Login with password</a>
        <div class="icon-input">
            <i class="iconfont icon-mobile" aria-hidden="true"></i>
            <input type="text" name="mobile" [(ngModel)]="mobile" i18n-placeholder placeholder="Please input phone number">
            @if (mobile.length > 0) {
            <i class="iconfont icon-close-circle" (click)="tapClearMobile()"></i>
            }
        </div>
        <div class="code-input">
            <input type="text" [(ngModel)]="code" i18n-placeholder placeholder="SMS verification code">
            <app-countdown-button class="send-btn" (tapped)="tapSendCode($event)"></app-countdown-button>
        </div>
        @if (captchaImage) {
        <div class="captcha-input">
            <input type="text" [(ngModel)]="captcha" i18n-placeholder placeholder="Captcha">
            <a (click)="tapCaptcha()" class="img-btn" i18n-title title="Click refresh">
                <img [src]="captchaImage" i18n-alt alt="Refresh and retry">
            </a>
        </div>
        }
        <app-action-button class="btn btn-primary" (tapped)="tapSignIn($event)" i18n>Sign in</app-action-button>
        <div class="agree-bar">
            <i class="iconfont" [ngClass]="{'icon-check-square-o': agree, 'icon-square-o': !agree}" (click)="tapToggleAgree()"></i>
            <ng-container i18n>I agree to</ng-container>
            <a class="strong-link" routerLink="/frontend/agreement" target="_blank" i18n>terms of service</a>
        </div>
    </div>
    <div class="mobile-body" [hidden]="tabIndex != 1">
        <a class="mobile-toggle" (click)="tapTab(0)" i18n>Back</a>
        <div class="icon-input">
            <i class="iconfont icon-mobile" aria-hidden="true"></i>
            <input type="text" name="mobile" [(ngModel)]="mobile" i18n-placeholder placeholder="Please input phone number">
            @if (mobile.length > 0) {
            <i class="iconfont icon-close-circle" (click)="tapClearMobile()"></i>
            }
        </div>
        <div class="icon-input">
            <i class="iconfont icon-lock" aria-hidden="true"></i>
            <input [type]="passwordObserve ? 'text' : 'password'"  name="password" [(ngModel)]="password" i18n-placeholder placeholder="Please input the password">
            @if (password.length > 0) {
            <i class="iconfont" (click)="tapToggleObserve()" [ngClass]="{'icon-eye': passwordObserve, 'icon-eye-slash': !passwordObserve}"></i>
            }
        </div>
        @if (captchaImage) {
        <div class="captcha-input">
            <input type="text" [(ngModel)]="captcha" i18n-placeholder placeholder="Please input the captcha">
            <a (click)="tapCaptcha()" class="btn" i18n-title title="Click refresh">
                <img [src]="captchaImage" i18n-alt alt="Refresh and retry">
            </a>
        </div>
        }
        <app-action-button class="btn btn-primary" (tapped)="tapSignIn($event)" i18n>Sign in</app-action-button>
    </div>
    <div class="email-body" [hidden]="tabIndex != 2">
        <div class="icon-input">
            <i class="iconfont icon-user" aria-hidden="true"></i>
            <input type="text" name="email" [(ngModel)]="email" i18n-placeholder placeholder="Please input username">
            @if (email.length > 0) {
            <i class="iconfont icon-close-circle" (click)="tapClearEmail()"></i>
            }
        </div>
        <div class="icon-input">
            <i class="iconfont icon-lock" aria-hidden="true"></i>
            <input [type]="passwordObserve ? 'text' : 'password'"  name="password" [(ngModel)]="password" i18n-placeholder placeholder="Please input the password">
            @if (password.length > 0) {
            <i class="iconfont" (click)="tapToggleObserve()" [ngClass]="{'icon-eye': passwordObserve, 'icon-eye-slash': !passwordObserve}"></i>
            }
        </div>
        @if (captchaImage) {
        <div class="captcha-input">
            <input type="text" [(ngModel)]="captcha" i18n-placeholder placeholder="Please input the captcha">
            <a (click)="tapCaptcha()" class="btn" i18n-title title="Click refresh">
                <img [src]="captchaImage" i18n-alt alt="Refresh and retry">
            </a>
        </div>
        }
        <app-action-button class="btn btn-primary" (tapped)="tapSignIn($event)" i18n>Sign in</app-action-button>
    </div>
    @if (tabIndex == 3) {
    <div class="qr-body">
        <div class="qr-img">
            <img [src]="qrImage">
            @if (qrStatus == 2) {
            <div class="failure-box">
                <i class="iconfont icon-refresh" (click)="tapRefreshQr()"></i>
                <p i18n>QR code has expired</p>
            </div>
            } @else if (qrStatus == 1) {
            <div class="scan-box">
                <i class="iconfont icon-check-circle"></i>
                <p i18n>Scanning is successful, waiting for confirmation</p>
            </div>
            }@else if (qrStatus == 3) {
            <div class="success-box">
                <i class="iconfont icon-check-circle"></i>
                <p i18n>Sign in successfully</p>
            </div>
            } @else if (qrStatus == 4) {
            <div class="failure-box">
                <i class="iconfont icon-refresh" (click)="tapRefreshQr()"></i>
                <p i18n>Sign in failed</p>
            </div>
            }
        </div>
        <div class="qr-label" i18n>Open the app and scan the QR code</div>
    </div>
    }
    <div class="email-body" [hidden]="tabIndex != 8">
        <div class="title-bar" i18n>Two-factor authentication</div>
        <div class="icon-input">
            <i class="iconfont icon-shield" aria-hidden="true"></i>
            <input type="text" i18n-placeholder placeholder="Authentication code" [(ngModel)]="twoFaCode">
        </div>


        <a (click)="tabIndex = 9" class="link-a" i18n>Use a recovery code or begin account recovery</a>

        <app-action-button class="btn btn-primary" (tapped)="tapSignIn($event)" i18n>Verify</app-action-button>

        <div class="panel-tip" i18n>
            Open your two-factor authenticator (TOTP) app or browser extension to view your authentication code.
        </div>
    </div>
    <div class="email-body" [hidden]="tabIndex != 9">
        <div class="title-bar" i18n>Use a Recovery Code</div>
        <div class="icon-input">
            <i class="iconfont icon-shield" aria-hidden="true"></i>
            <input type="text" i18n-placeholder placeholder="Recovery Code" [(ngModel)]="recoveryCode">
        </div>
    
        <app-action-button class="btn btn-primary" (tapped)="tapSignIn($event)" i18n>Verify</app-action-button>
    
        <div class="panel-tip" i18n>
            If you are unable to access your two-factor device, enter one of your recovery code to verify your identity
        </div>
    </div>

    <div class="panel-footer" [hidden]="tabIndex >= 8">
        <div class="oauth-bar">
            <a (click)="tapRefreshQr()" i18n-title title="Sign in with QR code"><i class="iconfont icon-qrcode"></i></a>
            @if (openWebAuthn) {
            <a (click)="tapWebAuthn()" i18n-title title="Sign in with WebAuthn"><i class="iconfont icon-fingerprint"></i></a>
            }
            @if (openAuth) {
                <a (click)="tapOAuth('qq')" i18n-title title="Sign in with QQ"><i class="iconfont icon-qq"></i></a>
                <a  (click)="tapOAuth('wechat')" i18n-title title="Sign in with weChat"><i class="iconfont icon-wechat"></i></a>
                <a  (click)="tapOAuth('weibo')" i18n-title title="Sign in with Weibo"><i class="iconfont icon-weibo"></i></a>
                <a  (click)="tapOAuth('github')" i18n-title title="Sign in with Github"><i class="iconfont icon-github"></i></a>
            }
        </div>
        <div class="tip-bar">
            @if (tabIndex < 2) {
            <a class="help-btn" routerLink="/frontend/about" i18n>Help?</a>
            } @else if (tabIndex == 2) {
            <a class="help-btn" routerLink="/auth/register" i18n>Sign up</a>
            } @else if (tabIndex == 2) {
            <a class="help-btn" routerLink="/auth/find" i18n>Forgot password?</a>
            }
        </div>
    </div>

</div>
